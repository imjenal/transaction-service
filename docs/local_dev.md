Ensure that you have followed the [prerequisites](./../README.md#prerequisites). Once you have followed the
prerequisites, you can proceed to the next steps below.

## Table of Contents

- [Running the application](#Running-the-application)
- [Commands](#commands)
- [Uses](#uses)
- [Working with the codebase](#working-with-the-codebase)
- [Adding new DB migrations](#adding-new-db-migrations)
- [Adding Dependencies](#adding-dependencies)
- [Before you commit](#before-you-commit)
- [Others](#best-practices)

### Running the application

- To start the application for development (with hot-reloading), run the following command:
```shell
make dev
```
It will install all the dependencies, run required services(postgres, etc) and start the application.

## Commands

- Use `make dev` to build and run the app with hot reload.
- Use `make lint` before pushing to check for any lint issues.
- Use `make test` to run the tests
- Use `make help` to see all the commands.

## Uses

The API uses the following libraries/packages:
- [gorilla/mux](https://github.com/gorilla/mux) for routing.
- [spf13/viper](https://github.com/spf13/viper) for configuration management.
- [go-playground/validator](https://github.com/go-playground/validator) for request validation.
- [sqlc](https://sqlc.dev/)  to query the database. To
    understand how sqlc you can watch this [video](https://www.youtube.com/watch?v=AgHdVPSty7k) and check out
    the [docs](https://docs.sqlc.dev/en/latest/index.html).

## Working with the codebase
- We have the APIs in the `api` package
  - The `v1` sub-package contains the APIs
  - The API + dependencies are initialized in the `api/api.go` file.
- DB related code is in the `internal/db` package.
  - `internal/db/models` package contains the generated code from sqlc.
  - `internal/db/sql` package contains the SQL queries used by sqlc for code-gen.
  - `internal/db/migrations` package contains database migrations. We use [golang-migrate](https://github.com/golang-migrate/migrate) to run the migrations.
- All the configurations are in the `config` package.
- Postman collection along with environment is present in `docs` directory
- `pkg/http/request` package contains helpers to read request data.
- `pkg/http/response` package contains helpers to write response data.

Consider the following example for users API:

- The routes for the accounts API are defined in `api/v1/accounts/routes.go`.
- The handlers for the accounts API are defined in `api/v1/accounts/*_handlers.go`
- The database functions are in the `api/v1/accounts/repository.go`. The repositories functions are wrappers around the db
  functions in the `internal/db/models` package. Most of the code in the models package is generated by sqlc.

## Adding new DB migrations
- Run `make new_migration name=<migration_name>` to create new migration files in the `internal/db/migrations`
  directory.

## Adding Dependencies
When adding new dependencies, ensure that the library is maintained and has a good community. Please avoid adding new
dependencies unless absolutely necessary. If you do need to add a new dependency, please follow the steps below:

- Add the dependency using `go get -u <dependency>`
- If you want to add a specific version, use `go get -u <dependency>@<version>` to get a specific version of the dependency.

## Before you commit
- Make sure you run `make pr` before commiting. `make pr` command runs following commands:
  - `make gen` to ensure that the generated code is up-to date.
  - `make fmt` to format all changes
  - `make tidy` to remove any unused dependencies
  - `make lint` to check for any lint issues.
  - `make test` to run the tests. 

## Others
- Entry point to the application (main function) is in [cmd/main.go](../cmd/main.go)
- We try to follow the [Uber Go Style Guide](https://github.com/uber-go/guide/blob/master/style.md) & [golang-standards/project-layout](https://github.com/golang-standards/project-layout) wherever
  possible.